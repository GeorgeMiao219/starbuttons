(function(t){function e(e){for(var n,s,o=e[0],c=e[1],l=e[2],d=0,f=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&f.push(r[s][0]),r[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==r[c]&&(n=!1)}n&&(i.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},r={app:0},i=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("cd49")},"485b":function(t,e,a){"use strict";var n=a("60c3"),r=a.n(n);r.a},"60c3":function(t,e,a){},7999:function(t,e,a){"use strict";var n=a("d935"),r=a.n(n);r.a},"85ed":function(t,e,a){"use strict";var n=a("acf2"),r=a.n(n);r.a},acf2:function(t,e,a){},b32a:function(t,e,a){"use strict";var n=a("c6b8"),r=a.n(n);r.a},c6b8:function(t,e,a){},cd49:function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},i=[],s=a("2877"),o={},c=Object(s["a"])(o,r,i,!1,null,null,null),l=c.exports,u=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("div",{staticClass:"settingsBtn",attrs:{title:t.$t("Toggle chorus mode")}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.multiPlay,expression:"multiPlay"}],attrs:{type:"checkbox",id:"isMutliplay"},domProps:{checked:Array.isArray(t.multiPlay)?t._i(t.multiPlay,null)>-1:t.multiPlay},on:{change:function(e){var a=t.multiPlay,n=e.target,r=!!n.checked;if(Array.isArray(a)){var i=null,s=t._i(a,i);n.checked?s<0&&(t.multiPlay=a.concat([i])):s>-1&&(t.multiPlay=a.slice(0,s).concat(a.slice(s+1)))}else t.multiPlay=r}}}),a("label",{attrs:{for:"isMutliplay"}},[t._v(t._s(t.$t("Do Not Click Me")))])]),a("div",{attrs:{id:"mainWrapper"}},[a("div",{class:{musicBoard:t.displayMusicBoard,musicButton:!t.displayMusicBoard,btn:!t.displayMusicBoard,animateBtn:!t.displayMusicBoard},attrs:{id:"board"},on:{click:t.playEhhh}},[a("div",{attrs:{id:"boardWrapper"}},[t._l(t.sounds,(function(e,n){return[t.displayMusicBoard?a("BaseButton",{key:n,staticClass:"normalBtn",attrs:{item:e}}):t._e()]}))],2),a("span",{attrs:{id:"bigButtonText"}},[t._v(" "+t._s(t.ehhhLocalizedName)+" ")])])]),a("BaseButton",{ref:"centralButton",attrs:{id:"virtualCentralButton",item:t.sounds[0]}}),a("div",{staticClass:"btn animateBtn",attrs:{id:"switchBtn"},on:{click:function(e){t.displayMusicBoard=!t.displayMusicBoard}}},[t._v(" "+t._s(t.displayMusicBoard?t.$t("Back"):t.$t("Music board"))+" ")]),a("div",{attrs:{id:"bottom"}},[a("a",{staticClass:"bottonBtnLink",attrs:{href:"https://github.com/suisei-cn/starbuttons",target:"_blank"}},[t._v(" "+t._s(t.$t("GitHub")))]),t._v("/ "),a("a",{staticClass:"bottonBtnLink",attrs:{href:"https://t.me/Hoshimati_Suisei",target:"_blank"}},[t._v(" "+t._s(t.$t("Telegram"))+" ")])])],1)},f=[],p=(a("b0c0"),a("d3b7"),a("ac1f"),a("466d"),a("841c"),a("1276"),a("96cf"),a("1da1")),h=a("d4ec"),m=a("bee2"),v=a("262e"),b=a("2caf"),y=a("9ab4"),g=a("60a3"),k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"btn animateBtn",class:{playingBtn:t.playLayer>0},on:{click:t.play}},[t._v(" "+t._s(t.localizedName)+" ")])},O=[],j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"self",class:{playingBtn:t.playLayer>0,testHoverWidth:t.testHoverWidth},style:{minWidth:t.minWidth},on:{click:t.play}},[t._v(" "+t._s(t.localizedName)+" ")])},x=[],w=function(t){Object(v["a"])(a,t);var e=Object(b["a"])(a);function a(){var t;return Object(h["a"])(this,a),t=e.apply(this,arguments),t.playLayer=0,t.testHoverWidth=!1,t.minWidth="0px",t.lang="zh",t}return Object(m["a"])(a,[{key:"mounted",value:function(){var t=this;this.lang=this.$i18n.locale,this.testHoverWidth=!0,this.$nextTick((function(){var e=t.$refs.self.offsetWidth;t.minWidth=String(e-16+"px"),t.testHoverWidth=!1}))}},{key:"play",value:function(){if(!this.noclickplay&&this.item&&(!(this.$store.getters.playing>0)||this.$store.state.multiPlay)){var t;t="string"===typeof this.item.file?this.item.file:this.item.file[Math.floor(Math.random()*this.item.file.length)];var e=new Audio("assets/".concat(t)),a=this;e.addEventListener("play",(function(){a.playLayer+=1,a.$store.commit("playOne")})),e.addEventListener("ended",(function(){a.playLayer-=1,a.$store.commit("stopOne")})),e.play()}}},{key:"localizedName",get:function(){return((null===this||void 0===this?void 0:this.item.name_l10n)||{})[this.lang]||(null===this||void 0===this?void 0:this.item.name)||""}}]),a}(g["c"]);Object(y["a"])([Object(g["b"])()],w.prototype,"item",void 0),Object(y["a"])([Object(g["b"])()],w.prototype,"noclickplay",void 0),w=Object(y["a"])([g["a"]],w);var _=w,B=_,$=Object(s["a"])(B,j,x,!1,null,null,null),A=$.exports,M=function(t){Object(v["a"])(a,t);var e=Object(b["a"])(a);function a(){return Object(h["a"])(this,a),e.apply(this,arguments)}return a}(A);M=Object(y["a"])([g["a"]],M);var P=M,C=P,S=(a("7999"),Object(s["a"])(C,k,O,!1,null,"0f5b01ee",null)),L=S.exports,R=function(t){Object(v["a"])(a,t);var e=Object(b["a"])(a);function a(){var t;return Object(h["a"])(this,a),t=e.apply(this,arguments),t.sounds=[{}],t.displayMusicBoard=!1,t}return Object(m["a"])(a,[{key:"playEhhh",value:function(){this.displayMusicBoard||this.$refs.centralButton.play()}},{key:"mounted",value:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("/sounds.json").then((function(t){return t.json()})).catch((function(){console.error("Sound data fetch error. Exiting.")}));case 2:this.sounds=t.sent,a=((null===(e=window.location.search.match(/lang=([a-zA-Z-]+)/))||void 0===e?void 0:e[1])||navigator.language||navigator.userLanguage).split("-")[0]||"zh",this.$i18n.locale=a;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"multiPlay",get:function(){return this.$store.state.multiPlay},set:function(t){this.$store.commit("setMultiPlay",t)}},{key:"ehhhLocalizedName",get:function(){return((null===this||void 0===this?void 0:this.sounds[0].name_l10n)||{})[this.$i18n.locale]||(null===this||void 0===this?void 0:this.sounds[0].name)||""}}]),a}(g["c"]);R=Object(y["a"])([Object(g["a"])({components:{CentralButton:L,BaseButton:A}})],R);var T=R,E=T,N=(a("b32a"),a("485b"),Object(s["a"])(E,d,f,!1,null,"1ed38f80",null)),H=N.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"page"}},[a("div",{attrs:{id:"header"}},[t._m(0),a("p",[t._v("You can remix the sounds at this page!")]),a("div",{style:{display:1===t.smallScreen?"none":"block",opacity:2===t.smallScreen?0:1},attrs:{id:"operations"}},[a("div",{staticClass:"normalBtn",on:{click:t.playRemix}},[t._v("Play")]),a("div",{staticClass:"normalBtn",on:{click:t.exportRemix}},[t._v("Export")]),a("div",{staticClass:"normalBtn",on:{click:t.clearRemix}},[t._v("Clear")])])]),a("div",{style:{display:0===t.smallScreen?"none":"block"},attrs:{id:"smallScreen"}},[a("p",[t._v("Your device screen is too small to run this editor. Sorry~")])]),a("div",{style:{display:1===t.smallScreen?"none":"block",opacity:2===t.smallScreen?0:1}},[a("div",{ref:"clips",attrs:{id:"buttons"}},[t._l(t.sounds,(function(t,e){return[a("BaseButton",{key:e,staticClass:"item normalBtn",attrs:{item:t,noclickplay:!0,"data-sound-id":e}})]}))],2),a("div",{ref:"editor",attrs:{id:"editor"}},[t._m(1)])])])},W=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h1",[t._v("Suisei Remix Editor "),a("sup",[t._v("experimental")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"tracks"}},[a("div",{staticClass:"track",attrs:{"data-track-id":"1"}}),a("div",{staticClass:"track",attrs:{"data-track-id":"2"}}),a("div",{staticClass:"track",attrs:{"data-track-id":"3"}}),a("div",{staticClass:"track",attrs:{"data-track-id":"4"}})])}],D=(a("99af"),a("a9e3"),a("4fad"),a("07ac"),a("3835")),q=a("5530"),G=a("b85c"),F=a("5014"),Y=a.n(F),J=(a("3ca3"),a("ddb0"),a("2b3d"),a("574a"));function U(t){return V.apply(this,arguments)}function V(){return V=Object(p["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){J(e,128,null,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)}))),V.apply(this,arguments)}function Z(t){return I.apply(this,arguments)}function I(){return I=Object(p["a"])(regeneratorRuntime.mark((function t(e){var a,n,r,i,s,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=new OfflineAudioContext(2,220500,44100),n=Object(G["a"])(e),t.prev=2,i=regeneratorRuntime.mark((function t(){var e,n,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=r.value,console.log("Fetching ".concat(e.musicurl)),t.next=4,fetch(e.musicurl).then((function(t){return t.blob()})).then((function(t){return t.arrayBuffer()}));case 4:return n=t.sent,i=a.createBufferSource(),t.next=8,a.decodeAudioData(n).catch((function(t){console.log("Error when decoding ".concat(e.musicurl,":"),t)}));case 8:if(s=t.sent,s){t.next=11;break}return t.abrupt("return","continue");case 11:console.log("Decoded ".concat(e.musicurl," delaying"),s,e.delay),i.buffer=s,i.connect(a.destination),i.start(e.delay);case 15:case"end":return t.stop()}}),t)})),n.s();case 5:if((r=n.n()).done){t.next=12;break}return t.delegateYield(i(),"t0",7);case 7:if(s=t.t0,"continue"!==s){t.next=10;break}return t.abrupt("continue",10);case 10:t.next=5;break;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t["catch"](2),n.e(t.t1);case 17:return t.prev=17,n.f(),t.finish(17);case 20:return console.log("Rendering..."),t.next=23,a.startRendering();case 23:return o=t.sent,t.next=26,U(o);case 26:return c=t.sent,l=URL.createObjectURL(c),t.abrupt("return",l);case 29:case"end":return t.stop()}}),t,null,[[2,14,17,20]])}))),I.apply(this,arguments)}var K={};function Q(t){return t.offsetLeft+Number(t.getAttribute("data-x")||-1*t.offsetLeft)}function X(t,e,a){var n=(parseFloat(t.getAttribute("data-x")||"")||0)+e,r=(parseFloat(t.getAttribute("data-y")||"")||0)+a;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+r+"px)",t.setAttribute("data-x",String(n)),t.setAttribute("data-y",String(r))}function tt(t){var e=t.target;X(e,t.dx,t.dy);var a=Number(e.getAttribute("data-seq-id"));if(K[a]){var n=Q(e);K[a].location=n}}window.editorElements=K;var et=function(t){Object(v["a"])(a,t);var e=Object(b["a"])(a);function a(){var t;return Object(h["a"])(this,a),t=e.apply(this,arguments),t.sounds=[],t.smallScreen=0,t.timelineLength=3,t}return Object(m["a"])(a,[{key:"loadVoice",value:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("/sounds.json").then((function(t){return t.json()})).catch((function(){console.error("Sound data fetch error. Exiting.")}));case 2:e=t.sent,a=Object(G["a"])(e);try{for(a.s();!(n=a.n()).done;)if(r=n.value,"string"===typeof r.file)this.sounds.push(r);else for(i=0;i<r.file.length;i++){for(o in s=Object(q["a"])({},r.name_l10n),s)s[o]+=" (".concat(i+1,")");c=Object.assign({},r,{name:"".concat(r.name," (").concat(i+1,")"),name_l10n:s,file:r.file[i]}),this.sounds.push(c)}}catch(l){a.e(l)}finally{a.f()}console.log(this.sounds);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"loadLang",value:function(){var t,e=((null===(t=window.location.search.match(/lang=([a-zA-Z-]+)/))||void 0===t?void 0:t[1])||navigator.language||navigator.userLanguage).split("-")[0]||"zh";this.$i18n.locale=e}},{key:"validateDisplay",value:function(){if(window.innerHeight>600)this.smallScreen=0;else{this.smallScreen=2;var t=this.$refs.editor.offsetHeight+this.$refs.editor.offsetTop;window.innerHeight<t?this.smallScreen=1:0!==t&&(this.smallScreen=0)}}},{key:"mounted",value:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadVoice();case 2:this.loadLang(),this.validateDisplay(),window.addEventListener("resize",this.validateDisplay),this.initDrag();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initDrag",value:function(){var t=this.$refs.clips.offsetLeft,e=this.$refs.clips.offsetTop,a=this;Y()(".item").draggable({inertia:!1,modifiers:[Y.a.modifiers.restrictRect({restriction:document.getElementById("page"),endOnly:!0})],listeners:{move:function(t){tt(t)},end:function(n){tt(n);var r=n.target;if(r.getAttribute("data-seq-id")){if(!r.getAttribute("data-in-track")){var i=r.cloneNode(!0);i.style.webkitTransform=i.style.transform="",i.removeAttribute("data-x"),i.removeAttribute("data-y"),i.removeAttribute("data-seq-id"),i.removeAttribute("data-in-track"),a.$refs.clips.appendChild(i),r.setAttribute("data-in-track","1"),X(r,r.offsetLeft-t-12,r.offsetTop-e-12),r.style.position="absolute"}}else r.getAttribute("data-in-track")?a.$refs.clips.removeChild(r):(r.style.webkitTransform=r.style.transform="",r.removeAttribute("data-x"),r.removeAttribute("data-y"))}}}),Y()(".track").dropzone({accept:".item",ondragenter:function(t){var e=t.relatedTarget,a=e.getAttribute("data-seq-id");a||(a=String(Math.random()),e.setAttribute("data-seq-id",a),K[a]={id:Number(e.getAttribute("data-sound-id")),location:-1})},ondragleave:function(t){var e=t.relatedTarget,a=e.getAttribute("data-seq-id");a&&(K[a]&&delete K[a],e.removeAttribute("data-seq-id"))}})}},{key:"playRemix",value:function(){var t=document.getElementsByClassName("track");if(t){for(var e=t[0],a=Number(e.offsetWidth)/this.timelineLength,n={},r=0,i=Object.entries(K);r<i.length;r++){var s=Object(D["a"])(i[r],2),o=s[0],c=s[1];if(!(c.id<0)){var l=c.id,u=n[o];if(!u){var d=this.sounds[l].file,f=new Audio("assets/".concat(d));f.preload="auto",n[o]=f}}}for(var p=function(){var t=Object(D["a"])(m[h],2),e=t[0],r=t[1];if(r.id<0||r.location<0)return"continue";setTimeout((function(){n[e].play()}),r.location/a*1e3)},h=0,m=Object.entries(K);h<m.length;h++)p()}}},{key:"clearRemix",value:function(){var t,e=Object(G["a"])(document.querySelectorAll(".item[data-seq-id]"));try{for(e.s();!(t=e.n()).done;){var a=t.value;this.$refs.clips.removeChild(a)}}catch(n){e.e(n)}finally{e.f()}K={}}},{key:"exportRemix",value:function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i,s,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=document.getElementsByClassName("track"),e){t.next=3;break}return t.abrupt("return");case 3:for(a=e[0],n=[],r=Number(a.offsetWidth)/this.timelineLength,i=0,s=Object.values(K);i<s.length;i++)o=s[i],n.push({musicurl:"assets/".concat(this.sounds[o.id].file),delay:o.location/r});return t.next=9,Z(n);case 9:c=t.sent,l=document.createElement("a"),l.href=c,l.download="output.mp3",l.click();case 14:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),a}(g["c"]);et=Object(y["a"])([Object(g["a"])({components:{BaseButton:A}})],et);var at=et,nt=at,rt=(a("85ed"),Object(s["a"])(nt,z,W,!1,null,"2cfdc36d",null)),it=rt.exports;n["a"].use(u["a"]);var st=[{path:"/",name:"Home",component:H},{path:"/editor",name:"Editor",component:it}],ot=new u["a"]({routes:st}),ct=ot,lt=a("2f62");n["a"].use(lt["a"]);var ut=new lt["a"].Store({state:{concurPlay:0,multiPlay:!0},getters:{playing:function(t){return t.concurPlay>0}},mutations:{playOne:function(t){t.concurPlay+=1},stopOne:function(t){t.concurPlay>0&&(t.concurPlay-=1)},setMultiPlay:function(t,e){t.multiPlay=e}}}),dt=a("a925"),ft={"Do Not Click Me":"没事不要点",GitHub:"代码猫",Telegram:"观星台","Toggle chorus mode":"多重吟唱模式开关","Music board":"声音面板",Back:"返回"},pt={"Do Not Click Me":"Do Not Click Me",GitHub:"GitHub",Telegram:"Telegram","Toggle chorus mode":"Toggle chorus mode","Music board":"Music board",Back:"Back"},ht={"Do Not Click Me":"クリックしないでください",GitHub:"GitHub",Telegram:"Telegram","Toggle chorus mode":"Toggle chorus mode","Music board":"Music board",Back:"Back"};n["a"].use(dt["a"]);var mt=new dt["a"]({locale:"zh",fallbackLocale:"en",messages:{en:pt,ja:ht,zh:ft}});n["a"].config.productionTip=!1,new n["a"]({router:ct,store:ut,i18n:mt,render:function(t){return t(l)}}).$mount("#app")},d935:function(t,e,a){}});
//# sourceMappingURL=app.7d2d189b.js.map